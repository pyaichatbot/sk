events {
    worker_connections 1024;
}

http {
    server {
        listen 80;
        server_name localhost;

        # Health check endpoint
        location /health {
            return 200 '{"status": "healthy", "service": "rag-agent", "version": "1.0.0"}';
            add_header Content-Type application/json;
        }

        # Service info endpoint
        location /service-info {
            return 200 '{"service_name": "rag-agent", "port": 8002, "health_endpoint": "/health", "tags": ["rag-agent", "agent", "rag"], "metadata": {"version": "1.0.0", "capabilities": ["rag_processing", "document_analysis", "knowledge_retrieval"]}}';
            add_header Content-Type application/json;
        }

        # Discovery metrics endpoint
        location /discovery-metrics {
            return 200 '{"service_name": "rag-agent", "registered": true, "health_score": 1.0, "last_health_check": "'$(date -u +%Y-%m-%dT%H:%M:%SZ)'"}';
            add_header Content-Type application/json;
        }

        # Mock agent processing endpoint
        location /process {
            if ($request_method = POST) {
                return 200 '{"content": "Mock RAG response: I have analyzed the provided documents and extracted key insights. Based on the search results, I can provide a comprehensive analysis covering AI fundamentals, machine learning concepts, and deep learning principles.", "success": true, "metadata": {"documents_analyzed": 5, "analysis_time": 0.4, "insights_count": 3}}';
                add_header Content-Type application/json;
            }
            return 405 '{"error": "Method not allowed"}';
            add_header Content-Type application/json;
        }

        # Default response
        location / {
            return 200 '{"service": "rag-agent", "status": "running", "endpoints": ["/health", "/service-info", "/discovery-metrics", "/process"]}';
            add_header Content-Type application/json;
        }
    }
}
